<!DOCTYPE html>
<html lang="zh-CN">
<head>
<link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ˜€</text></svg>">
<meta charset="UTF-8">
<title>ğŸ§  æœ€å¼ºå¤§è„‘Â·ä¸“æ³¨è®°å¿†è®­ç»ƒè¥</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
  :root{--primary:#4f46e5;--secondary:#f59e0b;--bg:#f8fafc}
  body{font-family:"PingFang SC","Microsoft YaHei",sans-serif;background:var(--bg);margin:0;display:flex;justify-content:center;min-height:100vh;-webkit-user-select:none;user-select:none}
  #game-container{background:white;width:95%;max-width:800px;padding:25px;margin:20px;border-radius:30px;box-shadow:0 20px 50px rgba(0,0,0,.1);text-align:center}
  .phrase-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(130px,1fr));gap:10px;margin:20px 0;max-height:350px;overflow-y:auto;padding:15px;background:#f1f5f9;border-radius:20px}
  .phrase-item{background:white;padding:8px;border-radius:10px;border:1px solid #e2e8f0;display:flex;flex-direction:column;cursor:pointer;transition:.2s}
  .phrase-item:hover{border-color:var(--primary);background:#eef2ff}
  .phrase-item .en{font-weight:bold;color:var(--primary);font-size:.95rem}
  .phrase-item .zh{color:#64748b;font-size:.8rem}
  .btn{background:var(--primary);color:white;border:none;padding:12px 25px;font-size:1rem;border-radius:12px;cursor:pointer;margin:5px;transition:.2s}
  .btn:active{transform:scale(.95)}
  .btn-outline{background:white;color:var(--primary);border:2px solid var(--primary)}
  .btn-gray{background:#666;color:white}
  .hidden{display:none}
  #result-box{background:#fff9eb;padding:25px;border-radius:20px;border:3px dashed var(--secondary);margin:15px}
  #result-en{font-size:3rem;font-weight:900}
  #result-zh{font-size:1.8rem;color:var(--secondary)}
  .tip-green{margin-top:8px;font-size:.9rem;color:#059669}
  .detective-box{background:#fff1f2;border:2px solid #fda4af;padding:20px;border-radius:20px;margin-top:20px;text-align:left;line-height:1.6}
  .correct-tag{color:#059669;font-weight:bold}
  .wrong-tag{color:#dc2626;font-weight:bold}
  .edit-row{display:grid;grid-template-columns:40px 1fr 1fr;gap:10px;margin-bottom:5px;text-align:left}
</style>
</head>
<body oncontextmenu="return false;">
<div id="game-container">
  <div id="view-welcome">
    <div style="text-align:right;margin-bottom:10px"><button class="btn btn-gray" onclick="_exitApp()">âŒ é€€å‡ºå…³é—­</button></div>
    <h1 style="color:#4f46e5;margin-bottom:5px">ğŸ§  æœ€å¼ºå¤§è„‘Â·ä¸“æ³¨è®°å¿†è®­ç»ƒè¥</h1>
    <p>3 åˆ†é’ŸæŒ‘æˆ˜ã€Œè¿‡ç›®ä¸å¿˜ã€ï¼Œé™ªå­©å­ä¸€èµ·æ‰¾å®è´ï¼</p>
    <div class="phrase-grid" id="all-phrases-list"></div>
 <input id="authInput" placeholder="è¯·è¾“å…¥æˆæƒç "
 style="padding:10px;border-radius:10px;border:1px solid #ccc">

<br><br>

<button class="btn" onclick="
  if(loginWithCode(document.getElementById('authInput').value)){
    function _0xStart() {
  requireAuth();   // â† åŠ è¿™ä¸€è¡Œ
  document.getElementById('view-welcome').classList.add('hidden');
  ...
}

    _0xStart();
  }
">ğŸ¯ è®°å¥½äº†ï¼Œå¼€å§‹ï¼</button>
    <button class="btn btn-outline" onclick="showEditor()">âœï¸ ç¼–è¾‘è¯åº“</button>
  </div>

  <div id="view-game" class="hidden">
    <div style="text-align:right;margin-bottom:10px"><button class="btn btn-outline" onclick="location.reload()">ğŸ  é€€å‡ºé‡ç©</button></div>
    <h2 id="card-title" style="color:#f59e0b">ç¬¬ 1 ç»„å¡ç‰‡</h2>
    <p>ä»”ç»†æ‰¾ä¸€æ‰¾ï¼Œè¿™é‡Œé¢æœ‰ä½ æƒ³çš„é‚£ä¸ªå®è´å—ï¼Ÿ</p>
    <div class="phrase-grid" id="card-phrases"></div>
    <button class="btn" onclick="_0xChoice(true)">âœ… æœ‰çš„</button>
    <button class="btn btn-outline" onclick="_0xChoice(false)">âŒ æ²¡æœ‰</button>
  </div>

  <div id="view-result" class="hidden">
    <div style="text-align:right;margin-bottom:10px"><button class="btn btn-outline" onclick="location.reload()">ğŸ  é€€å‡ºé‡ç©</button></div>
    <h1 id="result-title">ğŸ† æŒ‘æˆ˜æˆåŠŸï¼</h1>
    <div id="result-box"><div id="result-en"></div><div id="result-zh"></div></div>
    <p>æ˜¯è¿™ä¸ªå®è´å—ï¼Ÿ</p>
    <button class="btn" style="background:#059669" onclick="location.reload()">ğŸ‰ å¦‚æœæ˜¯ï¼Œç¥è´ºå…¨æ‰¾å¯¹äº†</button>
    <button class="btn" style="background:#dc2626" onclick="showCorrection()">âŒ ä¸æ˜¯ï¼Œå¸®æˆ‘æŸ¥ä¸‹é”™åœ¨å“ªï¼Ÿ</button>
  </div>

  <div id="view-correction" class="hidden">
    <div style="text-align:right;margin-bottom:10px"><button class="btn btn-outline" onclick="location.reload()">ğŸ  é€€å‡ºé‡ç©</button></div>
    <h2>ğŸ§ é­”æ³•ä¾¦æ¢åœ¨è°ƒæŸ¥...</h2>
    <p>è¯·å‘Šè¯‰ç”µè„‘ï¼Œä½ åˆšæ‰å¿ƒé‡Œæƒ³çš„æ˜¯å“ªä¸€ä¸ªå®è´ï¼Ÿ</p>
    <div class="phrase-grid" id="correction-list"></div>
    <div id="analysis-result" class="detective-box hidden"></div>
    <button class="btn" onclick="location.reload()" style="margin-top:20px">é‡æ–°å¼€å§‹ç»ƒä¹ </button>
  </div>

  <div id="view-editor" class="hidden">
    <h2>âœï¸ è¯åº“ç¼–è¾‘å™¨ï¼ˆå®¶é•¿æ¨¡å¼ï¼‰</h2>
    <div id="editor-list" style="max-height:400px;overflow-y:auto;margin-bottom:15px;"></div>
    <button class="btn" onclick="savePhrases()">ğŸ’¾ ä¿å­˜</button>
    <button class="btn btn-outline" onclick="location.reload()">è¿”å›</button>
  </div>
</div>
<script>
/* ===============================
   æˆæƒç³»ç»Ÿï¼ˆå•è®¾å¤‡ç»‘å®šç‰ˆï¼‰
   =============================== */

// ä½ å‘ç»™å®¶é•¿çš„æˆæƒç ï¼ˆå®Œæ•´è¾“å…¥ï¼‰
const VALID_CODES = [
  "KID-8F29A",
  "KID-A73QZ",
  "KID-P92KD"
];

// ç”Ÿæˆè®¾å¤‡æŒ‡çº¹ï¼ˆç¨³å®šã€ä¸æ¶‰åŠéšç§ï¼‰
function getDeviceId() {
  return btoa(
    navigator.userAgent +
    "|" + screen.width +
    "|" + screen.height +
    "|" + navigator.language
  );
}

// æœ¬åœ°æˆæƒè®°å½•è¡¨
// æ ¼å¼ï¼š{ æˆæƒç : è®¾å¤‡ID }
function getAuthMap() {
  return JSON.parse(localStorage.getItem("AUTH_MAP") || "{}");
}

function saveAuthMap(map) {
  localStorage.setItem("AUTH_MAP", JSON.stringify(map));
}

// å½“å‰æ˜¯å¦å·²æˆæƒ
function isAuthed() {
  const code = localStorage.getItem("AUTH_CODE");
  if (!code) return false;

  const map = getAuthMap();
  return map[code] === getDeviceId();
}

// ç™»å½•ï¼ˆå®¶é•¿è¾“å…¥æˆæƒç ï¼‰
function loginWithCode(inputCode) {
  const code = inputCode.trim();

  if (!VALID_CODES.includes(code)) {
    alert("âŒ æˆæƒç æ— æ•ˆ");
    return false;
  }

  const map = getAuthMap();
  const deviceId = getDeviceId();

  // ç¬¬ä¸€æ¬¡ä½¿ç”¨ï¼šç»‘å®šè®¾å¤‡
  if (!map[code]) {
    map[code] = deviceId;
    saveAuthMap(map);
  }

  // å·²è¢«å…¶ä»–è®¾å¤‡å ç”¨
  if (map[code] !== deviceId) {
    alert("âš ï¸ æ­¤æˆæƒç å·²åœ¨å¦ä¸€å°è®¾å¤‡ä½¿ç”¨");
    return false;
  }

  localStorage.setItem("AUTH_CODE", code);
  return true;
}

// å¼ºåˆ¶æ ¡éªŒï¼ˆæ¸¸æˆå¼€å§‹å‰è°ƒç”¨ï¼‰
function requireAuth() {
  if (!isAuthed()) {
    alert("è¯·å…ˆè¾“å…¥æˆæƒç ");
    location.reload();
  }
}
</script>

<script>
/* æ ¸å¿ƒå±è”½ */
document.onkeydown = (e) => { if (e.keyCode === 123 || (e.ctrlKey && e.keyCode === 85) || (e.ctrlKey && e.shiftKey && e.keyCode === 73)) return false; };

const defaultPhrases = [
  {id:1,english:"ä¸€å¿ƒä¸€æ„",chinese:"ä¸€å¿ƒä¸€æ„"},{id:2,english:"äºŒè¯ä¸è¯´",chinese:"äºŒè¯ä¸è¯´"},{id:3,english:"ä¸‰å¿ƒäºŒæ„",chinese:"ä¸‰å¿ƒäºŒæ„"},{id:4,english:"å››é¢å…«æ–¹",chinese:"å››é¢å…«æ–¹"},{id:5,english:"äº”é¢œå…­è‰²",chinese:"äº”é¢œå…­è‰²"},{id:6,english:"å…­ç¥æ— ä¸»",chinese:"å…­ç¥æ— ä¸»"},{id:7,english:"ä¸ƒä¸Šå…«ä¸‹",chinese:"ä¸ƒä¸Šå…«ä¸‹"},{id:8,english:"å…«ä»™è¿‡æµ·",chinese:"å…«ä»™è¿‡æµ·"},{id:9,english:"ä¹ç‰›ä¸€æ¯›",chinese:"ä¹ç‰›ä¸€æ¯›"},{id:10,english:"åå…¨åç¾",chinese:"åå…¨åç¾"},{id:11,english:"ç”»è›‡æ·»è¶³",chinese:"ç”»è›‡æ·»è¶³"},{id:12,english:"å®ˆæ ªå¾…å…”",chinese:"å®ˆæ ªå¾…å…”"},{id:13,english:"äº¡ç¾Šè¡¥ç‰¢",chinese:"äº¡ç¾Šè¡¥ç‰¢"},{id:14,english:"äº•åº•ä¹‹è›™",chinese:"äº•åº•ä¹‹è›™"},{id:15,english:"ç‹å‡è™å¨",chinese:"ç‹å‡è™å¨"},{id:16,english:"é¾Ÿå…”èµ›è·‘",chinese:"é¾Ÿå…”èµ›è·‘"},{id:17,english:"æ‹”è‹—åŠ©é•¿",chinese:"æ‹”è‹—åŠ©é•¿"},{id:18,english:"ç›²äººæ‘¸è±¡",chinese:"ç›²äººæ‘¸è±¡"},{id:19,english:"èƒ¸æœ‰æˆç«¹",chinese:"èƒ¸æœ‰æˆç«¹"},{id:20,english:"ä¸€ç®­åŒé›•",chinese:"ä¸€ç®­åŒé›•"},{id:21,english:"é£å’Œæ—¥ä¸½",chinese:"é£å’Œæ—¥ä¸½"},{id:22,english:"é¸Ÿè¯­èŠ±é¦™",chinese:"é¸Ÿè¯­èŠ±é¦™"},{id:23,english:"æ˜¥æš–èŠ±å¼€",chinese:"æ˜¥æš–èŠ±å¼€"},{id:24,english:"ç§‹é«˜æ°”çˆ½",chinese:"ç§‹é«˜æ°”çˆ½"},{id:25,english:"ç™½é›ªçš‘çš‘",chinese:"ç™½é›ªçš‘çš‘"},{id:26,english:"ç”µé—ªé›·é¸£",chinese:"ç”µé—ªé›·é¸£"},{id:27,english:"ç¹æ˜Ÿç‚¹ç‚¹",chinese:"ç¹æ˜Ÿç‚¹ç‚¹"},{id:28,english:"è“å¤©ç™½äº‘",chinese:"è“å¤©ç™½äº‘"},{id:29,english:"é’å±±ç»¿æ°´",chinese:"é’å±±ç»¿æ°´"},{id:30,english:"è½è‹±ç¼¤çº·",chinese:"è½è‹±ç¼¤çº·"},{id:31,english:"æ´¥æ´¥æœ‰å‘³",chinese:"æ´¥æ´¥æœ‰å‘³"},{id:32,english:"å“ˆå“ˆå¤§ç¬‘",chinese:"å“ˆå“ˆå¤§ç¬‘"},{id:33,english:"æ‰‹èˆè¶³è¹ˆ",chinese:"æ‰‹èˆè¶³è¹ˆ"},{id:34,english:"è‡ªè¨€è‡ªè¯­",chinese:"è‡ªè¨€è‡ªè¯­"},{id:35,english:"ä¸œå¼ è¥¿æœ›",chinese:"ä¸œå¼ è¥¿æœ›"},{id:36,english:"å‰ä»°ååˆ",chinese:"å‰ä»°ååˆ"},{id:37,english:"åˆè¹¦åˆè·³",chinese:"åˆè¹¦åˆè·³"},{id:38,english:"æ‘‡å¤´æ™ƒè„‘",chinese:"æ‘‡å¤´æ™ƒè„‘"},{id:39,english:"çœ‰å¼€çœ¼ç¬‘",chinese:"çœ‰å¼€çœ¼ç¬‘"},{id:40,english:"æ„çœ‰è‹¦è„¸",chinese:"æ„çœ‰è‹¦è„¸"},{id:41,english:"è‹¹æœçº¢çº¢",chinese:"è‹¹æœçº¢çº¢"},{id:42,english:"é¦™è•‰å¼¯å¼¯",chinese:"é¦™è•‰å¼¯å¼¯"},{id:43,english:"è‘¡è„ä¸²ä¸²",chinese:"è‘¡è„ä¸²ä¸²"},{id:44,english:"è¥¿ç“œåœ†åœ†",chinese:"è¥¿ç“œåœ†åœ†"},{id:45,english:"ç‰›å¥¶é¦™é¦™",chinese:"ç‰›å¥¶é¦™é¦™"},{id:46,english:"é¢åŒ…è½¯è½¯",chinese:"é¢åŒ…è½¯è½¯"},{id:47,english:"ç³–æœç”œç”œ",chinese:"ç³–æœç”œç”œ"},{id:48,english:"é¥¼å¹²è„†è„†",chinese:"é¥¼å¹²è„†è„†"},{id:49,english:"å†°æ·‡æ·‹å‡‰",chinese:"å†°æ·‡æ·‹å‡‰"},{id:50,english:"å¯ä¹æ³¡æ³¡",chinese:"å¯ä¹æ³¡æ³¡"},{id:51,english:"å°å°è„‘è¢‹",chinese:"å°å°è„‘è¢‹"},{id:52,english:"å¤§å¤§çœ¼ç›",chinese:"å¤§å¤§çœ¼ç›"},{id:53,english:"é•¿é•¿å¤´å‘",chinese:"é•¿é•¿å¤´å‘"},{id:54,english:"ç™½ç™½ç‰™é½¿",chinese:"ç™½ç™½ç‰™é½¿"},{id:55,english:"çº¢çº¢å˜´å·´",chinese:"çº¢çº¢å˜´å·´"},{id:56,english:"è½¯è½¯è€³æœµ",chinese:"è½¯è½¯è€³æœµ"},{id:57,english:"èƒ–èƒ–å°æ‰‹",chinese:"èƒ–èƒ–å°æ‰‹"},{id:58,english:"åšåšä¹¦æœ¬",chinese:"åšåšä¹¦æœ¬"},{id:59,english:"äº”å½©é“…ç¬”",chinese:"äº”å½©é“…ç¬”"},{id:60,english:"åœ†åœ†çš®çƒ",chinese:"åœ†åœ†çš®çƒ"},{id:61,english:"å¤©å¤©å¼€å¿ƒ",chinese:"å¤©å¤©å¼€å¿ƒ"},{id:62,english:"ç”Ÿæ—¥å¿«ä¹",chinese:"ç”Ÿæ—¥å¿«ä¹"},{id:63,english:"å­¦ä¹ è¿›æ­¥",chinese:"å­¦ä¹ è¿›æ­¥"}
];

let phrases = JSON.parse(localStorage.getItem('focusMemoryPhrases')) || defaultPhrases;
let _0xP1 = 0, _0xP2 = [], _0xP3 = 0;

function init() {
  const l = document.getElementById('all-phrases-list');
  phrases.forEach(p => l.appendChild(createItem(p)));
}

function createItem(p, fn) {
  const d = document.createElement('div');
  d.className = 'phrase-item';
  d.innerHTML = `<span class="en">${p.english}</span><span class="zh">${p.chinese}</span>`;
  if (fn) d.onclick = () => fn(p);
  return d;
}

function _0xStart() {
  document.getElementById('view-welcome').classList.add('hidden');
  document.getElementById('view-game').classList.remove('hidden');
  _0xP1 = 0; _0xP2 = []; _0xP3 = 0; _0xNext();
}

/* æ ¸å¿ƒï¼šæ‰“ä¹±é¡ºåºï¼ˆæ´—ç‰Œç®—æ³•ï¼‰ */
function _0xShuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function _0xNext() {
  const m = 1 << _0xP1;
  let c = phrases.filter(p => (p.id & m) !== 0);
  // å…³é”®ï¼šæ¯æ¬¡æ˜¾ç¤ºå‰æ‰“ä¹±é¡ºåºï¼Œä½ç½®ä¸å†å›ºå®š
  c = _0xShuffle(c);
  document.getElementById('card-title').innerText = `ç¬¬ ${_0xP1 + 1} ç»„å¡ç‰‡`;
  const b = document.getElementById('card-phrases');
  b.innerHTML = '';
  c.forEach(p => b.appendChild(createItem(p)));
}

function _0xChoice(y) {
  _0xP2.push(y);
  if (y) _0xP3 += 1 << _0xP1;
  _0xP1++;
  if (_0xP1 < 6) _0xNext(); else _0xEnd();
}

function _0xEnd() {
  document.getElementById('view-game').classList.add('hidden');
  document.getElementById('view-result').classList.remove('hidden');
  const r = phrases.find(p => p.id === _0xP3);
  document.getElementById('result-en').innerText = r ? r.english : "æ²¡çŒœä¸­...";
  document.getElementById('result-zh').innerText = r ? r.chinese : "æ˜¯ä¸æ˜¯è®°é”™å¡ç‰‡å•¦ï¼Ÿ";
}

function _exitApp() {
  if (typeof WeixinJSBridge !== "undefined") {
    WeixinJSBridge.call('closeWindow');
  } else {
    window.close();
    setTimeout(() => {
      document.getElementById('game-container').innerHTML = `<div style="padding:40px;"><h2>ğŸ§  è®­ç»ƒè¥å·²å…³é—­</h2><p>è¯·æ‰‹åŠ¨å…³é—­æ­¤é¡µé¢ã€‚</p><button class="btn" onclick="location.reload()">é‡æ–°è¿›å…¥</button></div>`;
    }, 100);
  }
}

function showCorrection() {
  document.getElementById('view-result').classList.add('hidden');
  document.getElementById('view-correction').classList.remove('hidden');
  const l = document.getElementById('correction-list');
  l.innerHTML = '';
  phrases.forEach(p => l.appendChild(createItem(p, (t) => {
    const b = document.getElementById('analysis-result');
    b.classList.remove('hidden');
    let h = `<b>ğŸ” ä¾¦æ¢è°ƒæŸ¥æŠ¥å‘Šï¼š</b>ä½ æƒ³çš„æ˜¯ï¼š<span class="correct-tag">${t.english}</span><br><br>`;
    let err = [];
    for(let i=0; i<6; i++) {
      if(((t.id & (1<<i))!==0) !== _0xP2[i]) err.push(`ç¬¬ ${i+1} å¼ å¡ç‰‡` + (_0xRec[i]?"å¤šé€‰äº†":"æ¼é€‰äº†"));
    }
    b.innerHTML = h + (err.length? `å‘ç°é”™è¯¯ï¼š<br>${err.join('<br>')}` : "æ¯ä¸€æ­¥éƒ½é€‰å¯¹äº†ï¼Œå†æ ¸å¯¹ä¸‹ç»“æœï¼Ÿ");
  })));
}

function showEditor() {
  document.getElementById('view-welcome').classList.add('hidden');
  document.getElementById('view-editor').classList.remove('hidden');
  const el = document.getElementById('editor-list');
  el.innerHTML = '';
  phrases.forEach((p, i) => {
    const r = document.createElement('div');
    r.className = 'edit-row';
    r.innerHTML = `<span>${p.id}</span><input id="en-${i}" value="${p.english}"><input id="zh-${i}" value="${p.chinese}">`;
    el.appendChild(r);
  });
}

function savePhrases() {
  phrases.forEach((p, i) => {
    p.english = document.getElementById(`en-${i}`).value.trim();
    p.chinese = document.getElementById(`zh-${i}`).value.trim();
  });
  localStorage.setItem('focusMemoryPhrases', JSON.stringify(phrases));
  location.reload();
}

init();
</script>
</body>

</html>
